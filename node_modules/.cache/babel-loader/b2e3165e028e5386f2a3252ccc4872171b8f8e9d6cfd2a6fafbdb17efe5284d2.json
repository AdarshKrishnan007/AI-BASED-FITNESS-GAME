{"ast":null,"code":"/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { activationFnSnippet, biasActivationSnippet } from './activation_util';\nimport { makeMatMulPackedSource, makeMatMulPackedVec4Source } from './matmul_packed_webgpu';\nimport { typeSnippet } from './webgpu_program';\nimport { computeDispatch, computeWorkgroupSizeForConv2d, computeWorkPerThreadForConv2d } from './webgpu_util';\nfunction conv2dCommonSnippet(isChannelsLast, fitAOuter, fitBOuter, fitInner) {\n  let addBias = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  let activation = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;\n  let hasPreluActivationWeights = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : false;\n  let innerElementSizeX = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : 4;\n  let innerElementSizeW = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : 4;\n  let innerElementSize = arguments.length > 9 && arguments[9] !== undefined ? arguments[9] : 4;\n  const getXSnippet = innerElementSize => {\n    switch (innerElementSize) {\n      case 1:\n        return 'resData = f32(x[xIndex]);';\n      case 3:\n        return 'resData = vec3<f32>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);';\n      case 4:\n        return 'resData = vec4<f32>(x[xIndex / 4]);';\n      default:\n        throw new Error(\"innerElementSize \".concat(innerElementSize, \" is not supported.\"));\n    }\n  };\n  const getWSnippet = innerElementSize => {\n    switch (innerElementSize) {\n      case 1:\n        return 'return f32(W[row * uniforms.wShape[3] + col]);';\n      case 4:\n        return 'return vec4<f32>(W[(row * uniforms.wShape[3] + col) / 4]);';\n      default:\n        throw new Error(\"innerElementSize \".concat(innerElementSize, \" is not supported.\"));\n    }\n  };\n  const coordASnippet = isChannelsLast ? \"\\n      let coord = vec4<i32>(batch, xRow, xCol, xCh);\\n      \" : \"\\n      let coord = vec4<i32>(batch, xCh, xRow, xCol);\\n      \";\n  const coordResSnippet = isChannelsLast ? \"\\n      let coords = vec4<i32>(\\n        batch,\\n        row / outWidth,\\n        row % outWidth,\\n        col);\\n      \" : \"\\n      let coords = vec4<i32>(\\n        batch,\\n        row,\\n        col / outWidth,\\n        col % outWidth);\\n      \";\n  const xHight = isChannelsLast ? 'uniforms.xShape[1]' : 'uniforms.xShape[2]';\n  const xWidth = isChannelsLast ? 'uniforms.xShape[2]' : 'uniforms.xShape[3]';\n  const row = isChannelsLast ? 'row' : 'col';\n  const col = isChannelsLast ? 'col' : 'row';\n  const readXSnippet = \"\\n      let inChannels = uniforms.wShape[2];\\n      let outWidth = \".concat(isChannelsLast ? 'uniforms.outShape[2]' : 'uniforms.outShape[3]', \";\\n      let outRow = \").concat(row, \" / outWidth;\\n      let outCol = \").concat(row, \" % outWidth;\\n\\n      let WRow = \").concat(col, \" / (uniforms.filterDims[1] * inChannels);\\n      let WCol = \").concat(col, \" / inChannels % uniforms.filterDims[1];\\n      let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * WRow - uniforms.pads[0];\\n      let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * WCol - uniforms.pads[1];\\n      let xCh = \").concat(col, \" % inChannels;\\n      var resData = \").concat(typeSnippet(innerElementSizeX), \"(0.0);\\n      // The bounds checking is always needed since we use it to pad zero for\\n      // the 'same' padding type.\\n      if (xRow >= 0 && xRow < \").concat(xHight, \" && xCol >= 0 && xCol < \").concat(xWidth, \") {\\n        \").concat(coordASnippet, \"\\n        let xIndex = getIndexFromCoords4D(coord, uniforms.xShape);\\n        \").concat(getXSnippet(innerElementSizeX), \"\\n      }\\n      return resData;\");\n  const sampleX = isChannelsLast ? fitAOuter && fitInner ? \"\\n      \".concat(readXSnippet) : \"\\n      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\\n        \".concat(readXSnippet, \"\\n      }\\n      return \").concat(typeSnippet(innerElementSizeX), \"(0.0);\") : fitInner && fitBOuter ? \"\\n      \".concat(readXSnippet) : \"\\n      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {\\n        \".concat(readXSnippet, \"\\n      }\\n      return \").concat(typeSnippet(innerElementSizeX), \"(0.0);\");\n  const sampleW = \"\".concat(getWSnippet(innerElementSizeW));\n  const resType = typeSnippet(innerElementSize);\n  const aType = isChannelsLast ? typeSnippet(innerElementSizeX) : typeSnippet(innerElementSizeW);\n  const bType = isChannelsLast ? typeSnippet(innerElementSizeW) : typeSnippet(innerElementSizeX);\n  const userCode = \"\\n      \".concat(activationFnSnippet(activation, hasPreluActivationWeights, innerElementSize === 4, 4), \"\\n      fn mm_readA(batch: i32, row : i32, col : i32) -> \").concat(aType, \" {\\n        \").concat(isChannelsLast ? sampleX : sampleW, \"\\n      }\\n\\n      fn mm_readB(batch: i32, row : i32, col : i32) -> \").concat(bType, \" {\\n        \").concat(isChannelsLast ? sampleW : sampleX, \"\\n      }\\n\\n      fn mm_write(batch: i32, row : i32, col : i32, valueIn : \").concat(resType, \") {\\n        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)\\n        {\\n        var value = valueIn;\\n        let outWidth = \").concat(isChannelsLast ? 'uniforms.outShape[2]' : 'uniforms.outShape[3]', \";\\n        \").concat(coordResSnippet, \"\\n        \").concat(biasActivationSnippet(addBias, activation), \"\\n        setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\\n        }\\n      }\");\n  return userCode;\n}\nexport class Conv2DMMProgram {\n  constructor(convInfo, dimAOuter, dimBOuter, dimInner) {\n    let addBias = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n    let activation = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;\n    let hasPreluActivationWeights = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : false;\n    let sequentialAccessByThreads = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : false;\n    this.variableNames = ['x', 'W'];\n    this.uniforms = \"filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,\";\n    this.outputShape = convInfo.outShape;\n    this.isChannelsLast = convInfo.dataFormat === 'channelsLast';\n    this.isVec4 = ((convInfo.inChannels % 4 === 0 || convInfo.inChannels % 3 === 0) && this.isChannelsLast || convInfo.outWidth % 4 === 0 && !this.isChannelsLast) && convInfo.outChannels % 4 === 0;\n    this.dispatchLayout = this.isChannelsLast ? {\n      x: [3],\n      y: [1, 2],\n      z: [0]\n    } : {\n      x: [2, 3],\n      y: [1],\n      z: [0]\n    };\n    this.workgroupSize = computeWorkgroupSizeForConv2d(this.dispatchLayout, this.outputShape, this.isVec4);\n    this.elementsPerThread = computeWorkPerThreadForConv2d(this.dispatchLayout, this.outputShape, this.isVec4);\n    this.dispatch = computeDispatch(this.dispatchLayout, this.outputShape, this.workgroupSize, this.elementsPerThread);\n    if (this.isVec4) {\n      this.outputComponent = 4;\n      if (this.isChannelsLast && convInfo.inChannels % 4 !== 0) {\n        this.innerElementSize = 3;\n        this.variableComponents = [1, 4];\n      } else {\n        this.innerElementSize = 4;\n        this.variableComponents = [4, 4];\n      }\n      if (addBias) {\n        this.variableNames.push('bias');\n        this.variableComponents.push(4);\n      }\n      if (hasPreluActivationWeights) {\n        this.variableNames.push('preluActivationWeights');\n        this.variableComponents.push(4);\n      }\n    } else {\n      this.innerElementSize = this.elementsPerThread[0];\n      if (addBias) {\n        this.variableNames.push('bias');\n      }\n      if (hasPreluActivationWeights) {\n        this.variableNames.push('preluActivationWeights');\n      }\n    }\n    this.sequentialAccessByThreads = sequentialAccessByThreads;\n    this.addBias = addBias;\n    this.activation = activation;\n    this.hasPreluActivationWeights = hasPreluActivationWeights;\n    this.tileAOuter = this.workgroupSize[1] * this.elementsPerThread[1];\n    this.tileBOuter = this.workgroupSize[0] * this.elementsPerThread[0];\n    this.tileInner = Math.max(this.workgroupSize[0] * this.innerElementSize, this.workgroupSize[1]);\n    this.fitAOuter = dimAOuter % this.tileAOuter === 0;\n    this.fitBOuter = dimBOuter % this.tileBOuter === 0;\n    this.fitInner = dimInner % this.tileInner === 0;\n    this.shaderKey = \"conv2DMM_\".concat(this.elementsPerThread, \"_\").concat(this.activation, \"}_\").concat(this.fitAOuter, \"_\").concat(this.fitBOuter, \"_\").concat(this.fitInner, \"_\").concat(this.isVec4, \"_\").concat(this.innerElementSize, \"_\").concat(this.isChannelsLast, \"_\").concat(this.sequentialAccessByThreads);\n  }\n  getUserCode() {\n    const matMulSource = this.isVec4 ? makeMatMulPackedVec4Source(this.elementsPerThread, this.workgroupSize, !this.isChannelsLast, this.tileInner) : makeMatMulPackedSource(this.elementsPerThread, this.workgroupSize, !this.isChannelsLast, this.tileInner, false, null, this.sequentialAccessByThreads);\n    const elementsSize = this.isVec4 ? [this.innerElementSize, 4, 4] : [1, 1, 1];\n    const userCode = \"\\n    \".concat(conv2dCommonSnippet(this.isChannelsLast, this.fitAOuter, this.fitBOuter, this.fitInner, this.addBias, this.activation, this.hasPreluActivationWeights, elementsSize[0], elementsSize[1], elementsSize[2]), \"\\n    \").concat(matMulSource, \"\\n  \");\n    return userCode;\n  }\n}","map":{"version":3,"names":["activationFnSnippet","biasActivationSnippet","makeMatMulPackedSource","makeMatMulPackedVec4Source","typeSnippet","computeDispatch","computeWorkgroupSizeForConv2d","computeWorkPerThreadForConv2d","conv2dCommonSnippet","isChannelsLast","fitAOuter","fitBOuter","fitInner","addBias","arguments","length","undefined","activation","hasPreluActivationWeights","innerElementSizeX","innerElementSizeW","innerElementSize","getXSnippet","Error","concat","getWSnippet","coordASnippet","coordResSnippet","xHight","xWidth","row","col","readXSnippet","sampleX","sampleW","resType","aType","bType","userCode","Conv2DMMProgram","constructor","convInfo","dimAOuter","dimBOuter","dimInner","sequentialAccessByThreads","variableNames","uniforms","outputShape","outShape","dataFormat","isVec4","inChannels","outWidth","outChannels","dispatchLayout","x","y","z","workgroupSize","elementsPerThread","dispatch","outputComponent","variableComponents","push","tileAOuter","tileBOuter","tileInner","Math","max","shaderKey","getUserCode","matMulSource","elementsSize"],"sources":["D:\\Fitness WebApp\\tfjs-backend-webgpu\\src\\conv2d_mm_webgpu.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util} from '@tensorflow/tfjs-core';\n\nimport {activationFnSnippet, biasActivationSnippet} from './activation_util';\nimport {makeMatMulPackedSource, makeMatMulPackedVec4Source} from './matmul_packed_webgpu';\nimport {typeSnippet, WebGPUProgram} from './webgpu_program';\nimport {computeDispatch, computeWorkgroupSizeForConv2d, computeWorkPerThreadForConv2d} from './webgpu_util';\n\nfunction conv2dCommonSnippet(\n    isChannelsLast: boolean, fitAOuter: boolean, fitBOuter: boolean,\n    fitInner: boolean, addBias = false,\n    activation: backend_util.Activation = null,\n    hasPreluActivationWeights = false, innerElementSizeX = 4,\n    innerElementSizeW = 4, innerElementSize = 4) {\n  const getXSnippet = (innerElementSize: number) => {\n    switch (innerElementSize) {\n      case 1:\n        return 'resData = f32(x[xIndex]);';\n      case 3:\n        return 'resData = vec3<f32>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);';\n      case 4:\n        return 'resData = vec4<f32>(x[xIndex / 4]);';\n      default:\n        throw new Error(\n            `innerElementSize ${innerElementSize} is not supported.`);\n    }\n  };\n  const getWSnippet = (innerElementSize: number) => {\n    switch (innerElementSize) {\n      case 1:\n        return 'return f32(W[row * uniforms.wShape[3] + col]);';\n      case 4:\n        return 'return vec4<f32>(W[(row * uniforms.wShape[3] + col) / 4]);';\n      default:\n        throw new Error(\n            `innerElementSize ${innerElementSize} is not supported.`);\n    }\n  };\n  const coordASnippet = isChannelsLast ? `\n      let coord = vec4<i32>(batch, xRow, xCol, xCh);\n      ` :\n                                         `\n      let coord = vec4<i32>(batch, xCh, xRow, xCol);\n      `;\n\n  const coordResSnippet = isChannelsLast ? `\n      let coords = vec4<i32>(\n        batch,\n        row / outWidth,\n        row % outWidth,\n        col);\n      ` :\n                                           `\n      let coords = vec4<i32>(\n        batch,\n        row,\n        col / outWidth,\n        col % outWidth);\n      `;\n\n  const xHight = isChannelsLast ? 'uniforms.xShape[1]' : 'uniforms.xShape[2]';\n  const xWidth = isChannelsLast ? 'uniforms.xShape[2]' : 'uniforms.xShape[3]';\n  const row = isChannelsLast ? 'row' : 'col';\n  const col = isChannelsLast ? 'col' : 'row';\n  const readXSnippet = `\n      let inChannels = uniforms.wShape[2];\n      let outWidth = ${\n      isChannelsLast ? 'uniforms.outShape[2]' : 'uniforms.outShape[3]'};\n      let outRow = ${row} / outWidth;\n      let outCol = ${row} % outWidth;\n\n      let WRow = ${col} / (uniforms.filterDims[1] * inChannels);\n      let WCol = ${col} / inChannels % uniforms.filterDims[1];\n      let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * WRow - uniforms.pads[0];\n      let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * WCol - uniforms.pads[1];\n      let xCh = ${col} % inChannels;\n      var resData = ${typeSnippet(innerElementSizeX)}(0.0);\n      // The bounds checking is always needed since we use it to pad zero for\n      // the 'same' padding type.\n      if (xRow >= 0 && xRow < ${xHight} && xCol >= 0 && xCol < ${xWidth}) {\n        ${coordASnippet}\n        let xIndex = getIndexFromCoords4D(coord, uniforms.xShape);\n        ${getXSnippet(innerElementSizeX)}\n      }\n      return resData;`;\n\n  const sampleX = isChannelsLast ? (fitAOuter && fitInner ? `\n      ${readXSnippet}` :\n                                                            `\n      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {\n        ${readXSnippet}\n      }\n      return ${typeSnippet(innerElementSizeX)}(0.0);`) :\n                                   (fitInner && fitBOuter ? `\n      ${readXSnippet}` :\n                                                            `\n      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {\n        ${readXSnippet}\n      }\n      return ${typeSnippet(innerElementSizeX)}(0.0);`);\n\n  const sampleW = `${getWSnippet(innerElementSizeW)}`;\n\n  const resType = typeSnippet(innerElementSize);\n  const aType = isChannelsLast ? typeSnippet(innerElementSizeX) :\n                                 typeSnippet(innerElementSizeW);\n  const bType = isChannelsLast ? typeSnippet(innerElementSizeW) :\n                                 typeSnippet(innerElementSizeX);\n  const userCode = `\n      ${\n      activationFnSnippet(\n          activation, hasPreluActivationWeights, innerElementSize === 4, 4)}\n      fn mm_readA(batch: i32, row : i32, col : i32) -> ${aType} {\n        ${isChannelsLast ? sampleX : sampleW}\n      }\n\n      fn mm_readB(batch: i32, row : i32, col : i32) -> ${bType} {\n        ${isChannelsLast ? sampleW : sampleX}\n      }\n\n      fn mm_write(batch: i32, row : i32, col : i32, valueIn : ${resType}) {\n        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)\n        {\n        var value = valueIn;\n        let outWidth = ${\n      isChannelsLast ? 'uniforms.outShape[2]' : 'uniforms.outShape[3]'};\n        ${coordResSnippet}\n        ${biasActivationSnippet(addBias, activation)}\n        setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n        }\n      }`;\n  return userCode;\n}\n\nexport class Conv2DMMProgram implements WebGPUProgram {\n  outputShape: number[];\n  shaderKey: string;\n  dispatchLayout: {x: number[], y: number[], z: number[]};\n  dispatch: [number, number, number];\n  variableNames = ['x', 'W'];\n  variableComponents: number[];\n  uniforms =\n      `filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,`;\n  workgroupSize: [number, number, number];\n  elementsPerThread: [number, number, number];\n  addBias: boolean;\n  activation: backend_util.Activation;\n  hasPreluActivationWeights: boolean;\n  isChannelsLast: boolean;\n  fitAOuter: boolean;\n  fitBOuter: boolean;\n  fitInner: boolean;\n  tileAOuter: number;\n  tileBOuter: number;\n  tileInner: number;\n  innerElementSize: number;\n  isVec4?: boolean;\n  outputComponent: number;\n  private sequentialAccessByThreads: boolean;\n\n  constructor(\n      convInfo: backend_util.Conv2DInfo, dimAOuter: number, dimBOuter: number,\n      dimInner: number, addBias = false,\n      activation: backend_util.Activation = null,\n      hasPreluActivationWeights = false, sequentialAccessByThreads = false) {\n    this.outputShape = convInfo.outShape;\n    this.isChannelsLast = convInfo.dataFormat === 'channelsLast';\n    this.isVec4 =\n        (((convInfo.inChannels % 4 === 0 || convInfo.inChannels % 3 === 0) &&\n          this.isChannelsLast) ||\n         (convInfo.outWidth % 4 === 0 && !this.isChannelsLast)) &&\n        convInfo.outChannels % 4 === 0;\n    this.dispatchLayout = this.isChannelsLast ? {x: [3], y: [1, 2], z: [0]} :\n                                                {x: [2, 3], y: [1], z: [0]};\n    this.workgroupSize = computeWorkgroupSizeForConv2d(\n        this.dispatchLayout, this.outputShape, this.isVec4);\n    this.elementsPerThread = computeWorkPerThreadForConv2d(\n        this.dispatchLayout, this.outputShape, this.isVec4);\n\n    this.dispatch = computeDispatch(\n        this.dispatchLayout, this.outputShape, this.workgroupSize,\n        this.elementsPerThread);\n\n    if (this.isVec4) {\n      this.outputComponent = 4;\n      if (this.isChannelsLast && convInfo.inChannels % 4 !== 0) {\n        this.innerElementSize = 3;\n        this.variableComponents = [1, 4];\n      } else {\n        this.innerElementSize = 4;\n        this.variableComponents = [4, 4];\n      }\n\n      if (addBias) {\n        this.variableNames.push('bias');\n        this.variableComponents.push(4);\n      }\n\n      if (hasPreluActivationWeights) {\n        this.variableNames.push('preluActivationWeights');\n        this.variableComponents.push(4);\n      }\n    } else {\n      this.innerElementSize = this.elementsPerThread[0];\n      if (addBias) {\n        this.variableNames.push('bias');\n      }\n\n      if (hasPreluActivationWeights) {\n        this.variableNames.push('preluActivationWeights');\n      }\n    }\n\n    this.sequentialAccessByThreads = sequentialAccessByThreads;\n    this.addBias = addBias;\n    this.activation = activation;\n    this.hasPreluActivationWeights = hasPreluActivationWeights;\n\n    this.tileAOuter = this.workgroupSize[1] * this.elementsPerThread[1];\n    this.tileBOuter = this.workgroupSize[0] * this.elementsPerThread[0];\n    this.tileInner = Math.max(\n        this.workgroupSize[0] * this.innerElementSize, this.workgroupSize[1]);\n\n    this.fitAOuter = dimAOuter % this.tileAOuter === 0;\n    this.fitBOuter = dimBOuter % this.tileBOuter === 0;\n    this.fitInner = dimInner % this.tileInner === 0;\n\n    this.shaderKey = `conv2DMM_${this.elementsPerThread}_${this.activation}}_${\n        this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${\n        this.innerElementSize}_${this.isChannelsLast}_${\n        this.sequentialAccessByThreads}`;\n  }\n\n  getUserCode(): string {\n    const matMulSource = this.isVec4 ?\n        makeMatMulPackedVec4Source(\n            this.elementsPerThread, this.workgroupSize, !this.isChannelsLast,\n            this.tileInner) :\n        makeMatMulPackedSource(\n            this.elementsPerThread, this.workgroupSize, !this.isChannelsLast,\n            this.tileInner, false, null, this.sequentialAccessByThreads);\n    const elementsSize =\n        this.isVec4 ? [this.innerElementSize, 4, 4] : [1, 1, 1];\n    const userCode = `\n    ${\n        conv2dCommonSnippet(\n            this.isChannelsLast, this.fitAOuter, this.fitBOuter, this.fitInner,\n            this.addBias, this.activation, this.hasPreluActivationWeights,\n            elementsSize[0], elementsSize[1], elementsSize[2])}\n    ${matMulSource}\n  `;\n    return userCode;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}