{"ast":null,"code":"/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { BinaryOpType, getBinaryOpString } from './binary_op_util';\nimport { getUnaryOpString, UnaryOpType } from './unary_op_util';\nimport { typeSnippet } from './webgpu_program';\nexport function activationFnSnippet(activation) {\n  let hasPreluActivationWeights = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  let packed = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  let coordsLength = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 3;\n  if (activation === null) {\n    return '';\n  }\n  let activationOpSnippet = '';\n  if (activation === 'linear') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.LINEAR);\n  } else if (activation === 'relu') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.RELU, packed);\n  } else if (activation === 'elu') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.ELU, packed);\n  } else if (activation === 'relu6') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.RELU6, packed);\n  } else if (activation === 'prelu') {\n    activationOpSnippet = getBinaryOpString(BinaryOpType.PRELU, packed);\n  } else if (activation === 'sigmoid') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.SIGMOID, packed);\n  } else if (activation === 'leakyrelu') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.LEAKYRELU, packed);\n  } else {\n    throw new Error(\"Activation \".concat(activation, \" has not been implemented for the WebGPU backend.\"));\n  }\n  const elementSize = packed ? 4 : 1;\n  const dataType = typeSnippet(elementSize);\n  let activationFnSnippet = '';\n  if (hasPreluActivationWeights) {\n    activationFnSnippet = \"\\n      fn activation(a : \".concat(dataType, \", coords : vec\").concat(coordsLength, \"<i32>) -> \").concat(dataType, \" {\\n        let b = getPreluActivationWeightsByOutputCoords(coords);\\n        \").concat(activationOpSnippet, \"\\n      }\");\n  } else {\n    activationFnSnippet = \"\\n      fn activation(a : \".concat(dataType, \", coords : vec\").concat(coordsLength, \"<i32>) -> \").concat(dataType, \" {\\n        \").concat(activationOpSnippet, \"\\n      }\");\n  }\n  return activationFnSnippet;\n}\nexport function biasActivationSnippet(hasBias, activation) {\n  return \"\\n      \".concat(hasBias ? 'value = value + getBiasByOutputCoords(coords);' : '', \"\\n      \").concat(activation ? 'value = activation(value, coords);' : '', \"\\n      \");\n}","map":{"version":3,"names":["BinaryOpType","getBinaryOpString","getUnaryOpString","UnaryOpType","typeSnippet","activationFnSnippet","activation","hasPreluActivationWeights","arguments","length","undefined","packed","coordsLength","activationOpSnippet","LINEAR","RELU","ELU","RELU6","PRELU","SIGMOID","LEAKYRELU","Error","concat","elementSize","dataType","biasActivationSnippet","hasBias"],"sources":["D:\\Fitness WebApp\\tfjs-backend-webgpu\\src\\activation_util.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util} from '@tensorflow/tfjs-core';\n\nimport {BinaryOpType, getBinaryOpString} from './binary_op_util';\nimport {getUnaryOpString, UnaryOpType} from './unary_op_util';\nimport {typeSnippet} from './webgpu_program';\n\nexport function activationFnSnippet(\n    activation: backend_util.Activation, hasPreluActivationWeights = false,\n    packed = false, coordsLength = 3): string {\n  if (activation === null) {\n    return '';\n  }\n\n  let activationOpSnippet = '';\n  if (activation === 'linear') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.LINEAR);\n  } else if (activation === 'relu') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.RELU, packed);\n  } else if (activation === 'elu') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.ELU, packed);\n  } else if (activation === 'relu6') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.RELU6, packed);\n  } else if (activation === 'prelu') {\n    activationOpSnippet = getBinaryOpString(BinaryOpType.PRELU, packed);\n  } else if (activation === 'sigmoid') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.SIGMOID, packed);\n  } else if (activation === 'leakyrelu') {\n    activationOpSnippet = getUnaryOpString(UnaryOpType.LEAKYRELU, packed);\n  } else {\n    throw new Error(`Activation ${\n        activation} has not been implemented for the WebGPU backend.`);\n  }\n  const elementSize = packed ? 4 : 1;\n  const dataType = typeSnippet(elementSize);\n  let activationFnSnippet = '';\n  if (hasPreluActivationWeights) {\n    activationFnSnippet = `\n      fn activation(a : ${dataType}, coords : vec${coordsLength}<i32>) -> ${\n        dataType} {\n        let b = getPreluActivationWeightsByOutputCoords(coords);\n        ${activationOpSnippet}\n      }`;\n  } else {\n    activationFnSnippet = `\n      fn activation(a : ${dataType}, coords : vec${coordsLength}<i32>) -> ${\n        dataType} {\n        ${activationOpSnippet}\n      }`;\n  }\n  return activationFnSnippet;\n}\n\nexport function biasActivationSnippet(\n    hasBias: boolean, activation: backend_util.Activation): string {\n  return `\n      ${hasBias ? 'value = value + getBiasByOutputCoords(coords);' : ''}\n      ${activation ? 'value = activation(value, coords);' : ''}\n      `;\n}\n"],"mappings":"AAAA;;;;;;;;;;;;;;;;AAmBA,SAAQA,YAAY,EAAEC,iBAAiB,QAAO,kBAAkB;AAChE,SAAQC,gBAAgB,EAAEC,WAAW,QAAO,iBAAiB;AAC7D,SAAQC,WAAW,QAAO,kBAAkB;AAE5C,OAAM,SAAUC,mBAAmBA,CAC/BC,UAAmC,EACH;EAAA,IADKC,yBAAyB,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,KAAK;EAAA,IACtEG,MAAM,GAAAH,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,KAAK;EAAA,IAAEI,YAAY,GAAAJ,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC;EAClC,IAAIF,UAAU,KAAK,IAAI,EAAE;IACvB,OAAO,EAAE;;EAGX,IAAIO,mBAAmB,GAAG,EAAE;EAC5B,IAAIP,UAAU,KAAK,QAAQ,EAAE;IAC3BO,mBAAmB,GAAGX,gBAAgB,CAACC,WAAW,CAACW,MAAM,CAAC;GAC3D,MAAM,IAAIR,UAAU,KAAK,MAAM,EAAE;IAChCO,mBAAmB,GAAGX,gBAAgB,CAACC,WAAW,CAACY,IAAI,EAAEJ,MAAM,CAAC;GACjE,MAAM,IAAIL,UAAU,KAAK,KAAK,EAAE;IAC/BO,mBAAmB,GAAGX,gBAAgB,CAACC,WAAW,CAACa,GAAG,EAAEL,MAAM,CAAC;GAChE,MAAM,IAAIL,UAAU,KAAK,OAAO,EAAE;IACjCO,mBAAmB,GAAGX,gBAAgB,CAACC,WAAW,CAACc,KAAK,EAAEN,MAAM,CAAC;GAClE,MAAM,IAAIL,UAAU,KAAK,OAAO,EAAE;IACjCO,mBAAmB,GAAGZ,iBAAiB,CAACD,YAAY,CAACkB,KAAK,EAAEP,MAAM,CAAC;GACpE,MAAM,IAAIL,UAAU,KAAK,SAAS,EAAE;IACnCO,mBAAmB,GAAGX,gBAAgB,CAACC,WAAW,CAACgB,OAAO,EAAER,MAAM,CAAC;GACpE,MAAM,IAAIL,UAAU,KAAK,WAAW,EAAE;IACrCO,mBAAmB,GAAGX,gBAAgB,CAACC,WAAW,CAACiB,SAAS,EAAET,MAAM,CAAC;GACtE,MAAM;IACL,MAAM,IAAIU,KAAK,eAAAC,MAAA,CACXhB,UAAU,sDAAmD,CAAC;;EAEpE,MAAMiB,WAAW,GAAGZ,MAAM,GAAG,CAAC,GAAG,CAAC;EAClC,MAAMa,QAAQ,GAAGpB,WAAW,CAACmB,WAAW,CAAC;EACzC,IAAIlB,mBAAmB,GAAG,EAAE;EAC5B,IAAIE,yBAAyB,EAAE;IAC7BF,mBAAmB,gCAAAiB,MAAA,CACGE,QAAQ,oBAAAF,MAAA,CAAiBV,YAAY,gBAAAU,MAAA,CACvDE,QAAQ,oFAAAF,MAAA,CAENT,mBAAmB,cACrB;GACL,MAAM;IACLR,mBAAmB,gCAAAiB,MAAA,CACGE,QAAQ,oBAAAF,MAAA,CAAiBV,YAAY,gBAAAU,MAAA,CACvDE,QAAQ,kBAAAF,MAAA,CACNT,mBAAmB,cACrB;;EAEN,OAAOR,mBAAmB;AAC5B;AAEA,OAAM,SAAUoB,qBAAqBA,CACjCC,OAAgB,EAAEpB,UAAmC;EACvD,kBAAAgB,MAAA,CACMI,OAAO,GAAG,gDAAgD,GAAG,EAAE,cAAAJ,MAAA,CAC/DhB,UAAU,GAAG,oCAAoC,GAAG,EAAE;AAE9D","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}